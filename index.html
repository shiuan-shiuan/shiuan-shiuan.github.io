<html lang="en-US" xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/11">

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width initial-scale=1.0 maximum-scale=1.0 user-scalable=yes" />

    <link href="leaflet/webmobile.css" rel="stylesheet" type="text/css" />
    <link href="leaflet/leaflet.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="leaflet/jquery.min.js"></script>
    <script type="text/javascript" src="leaflet/jquery-ui.min.js"></script>
    <script type="text/javascript" src="leaflet/simpler-sidebar.min.js"></script>
    <script type="text/javascript" src="leaflet/leaflet.js"></script>
    <script type="text/javascript" src="leaflet/leaflet-omnivore.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
          crossorigin="" />

    <style>
        html, body {
            height: 100%;
            margin: 0;
        }

        #map {
            width: 600px;
            height: 400px;
        }
    </style>
    <style>
        body {
            padding: 0;
            margin: 0;
        }

        #map {
            height: 100%;
            width: 100vw;
        }
    </style>

    <script>

        var leafletmap = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 18,
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ',
            id: 'leaflet.streets'
        })

    </script>

</head>

<body>

    <div id="map" class="map">
        <div id="map" style="height: 100%; border: 1px solid #AAA;"></div>
        <script language=JavaScript></script>

        <script>
            var mbAttr = 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
                '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
                mbUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';

            var grayscale = L.tileLayer(mbUrl, { attribution: mbAttr })

            var map = L.map('map', {
                center: [24.17, 120.85],
                zoom: 11,
                layers: [grayscale]
            }).fitWorld();

            var baseLayers = {
                "Leaflet": leafletmap
            };

            map.setView([24.151687694799833, 120.64116954803465], 12);
            L.control.scale().addTo(map);
            L.control.layers(baseLayers, overlays).addTo(map);
        </script>
    </div>


    <script>   

        function onLocationFound(e) {
            var radius = e.accuracy / 2;

            var redIcon = L.icon({
                iconUrl: 'red.ico',
                iconSize: [40, 40],
                iconAnchor: [22, 94], // point of the icon which will correspond to marker's location
            });

            var myMarker = new L.Marker(e.latlng, { icon: redIcon }).addTo(map)
                .bindPopup("You are within " + radius + " meters from this point").openPopup();


            //L.marker(e.latlng).addTo(map)
            //    .bindPopup("You are within " + radius + " meters from this point").openPopup();

            L.circle(e.latlng, radius).addTo(map);
        }

        /*地理定位失敗，顯示錯誤消息*/
        function onLocationError(e) {
            alert(e.message);
        }
        map.on('locationfound', onLocationFound);
        map.on('locationerror', onLocationError);

        /*將地圖視圖縮放到檢測到的位置*/
        map.locate({ setView: true, maxZoom: 15 });

        var url = '開關箱8020296_WGS84.kml';
        doSomething(url);
        
        function doSomething(url) {
            var runlayer = omnivore.kml('開關箱8020296_WGS84.kml').on('ready', function (layer) {
                this.eachLayer(function (value) {
                });
                var a0 = runlayer.toGeoJSON().features.length;
                var array = [], array2 = [];
                var array1 = [], array3 = [];

                for (var i = 0; i < a0; i++) {
                    if (runlayer.toGeoJSON().features[i].geometry.hasOwnProperty("coordinates")) {
                        var a1 = runlayer.toGeoJSON().features[i].geometry.coordinates.length;
                        array2 = [runlayer.toGeoJSON().features[i].geometry.coordinates[1], runlayer.toGeoJSON().features[i].geometry.coordinates[0]];
                        array.push(array2);
                        
                        var myMarker = new L.marker(array2).addTo(map);

                        array = [];
                    }
                    else {
                        /*
                        var a2 = runlayer.toGeoJSON().features[i].geometry.geometries.length;
                        for (var k = 0; k < a2; k++) {
                            var a3 = runlayer.toGeoJSON().features[i].geometry.geometries[k].coordinates.length;
                            for (var l = 0; l < a3; l++) {
                                array3 = [runlayer.toGeoJSON().features[i].geometry.geometries[k].coordinates[l][1], runlayer.toGeoJSON().features[i].geometry.geometries[k].coordinates[l][0]];
                                array1.push(array3);
                            }
                            var polyline = L.polyline(array, { color: 'red' }).addTo(map);
                            array1 = [];  
                         */
                    }
                }
            });
        }
              
    </script>
</body>
</html>
